<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor IPTV</title>
    <style>
        /* Estilos generales */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1e1e2f; /* Fondo oscuro */
            color: #ffffff; /* Texto blanco */
            margin: 0;
            padding: 20px;
        }

        .container {
            background-color: #2a2a40; /* Fondo del contenedor */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-size: 28px;
            color: #00ff88; /* Color verde neón */
            text-align: center;
            margin-bottom: 20px;
        }

        /* Leyenda en movimiento */
        .leyenda-movimiento {
            margin-top: 20px;
            padding: 10px;
            background-color: #00ff88; /* Fondo verde neón */
            color: #1e1e2f; /* Texto oscuro */
            font-weight: bold;
            text-align: center;
            border-radius: 8px;
            overflow: hidden;
            white-space: nowrap;
        }

        .leyenda-movimiento marquee {
            font-size: 16px;
        }

        /* Resto de los estilos */
        .info label {
            font-weight: bold;
            color: #00ff88; /* Color verde neón */
            display: block;
            margin-bottom: 5px;
        }

        .info input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #00ff88;
            border-radius: 8px;
            background-color: #1e1e2f;
            color: #ffffff;
        }

        .button {
            background-color: #00ff88;
            color: #1e1e2f;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background-color: #00cc66; /* Verde más oscuro al pasar el mouse */
        }

        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        .status.activa {
            background-color: #00ff88;
            color: #1e1e2f;
        }

        .status.inactiva {
            background-color: #ff4444;
            color: #ffffff;
        }

        .player {
            margin-top: 20px;
            display: none;
        }

        .player video {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .content-list {
            margin-top: 20px;
        }

        .content-list ul {
            list-style-type: none;
            padding: 0;
        }

        .content-list li:hover {
            background-color: #3a3a5a;
        }
        
        .content-list {
            cursor: pointer;
            padding: 8px;
            border-bottom: 1px solid #444;
            transition: background-color 0.2s ease;
        }
        
        .content-list:hover {
            background-color: #3a3a5a;
        }

        .category {
            font-weight: bold;
            margin-top: 20px;
            color: #00ff88;
            cursor: pointer;
        }

        .subcategory {
            margin-left: 20px;
            color: #ffffff;
        }

        .pip-button {
            margin-top: 10px;
            background-color: #00ff88;
            color: #1e1e2f;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .pip-button:hover {
            background-color: #00cc66;
        }

        .hidden {
            display: none;
        }

        .highlight {
            font-weight: bold;
            color: #00ff88;
        }

        .total-group {
            margin-top: 10px;
            padding: 10px;
            background-color: #3a3a5a;
            border-radius: 8px;
            color: #ffffff;
        }

        .menu {
            background-color: #2a2a40;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .menu ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: space-around;
        }

        .menu li {
            display: inline;
        }

        .menu a {
            color: #ffffff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        .menu a:hover {
            color: #00ff88;
        }
        
        .menu a.disabled {
            color: #5a5a70;
            cursor: not-allowed;
            pointer-events: none;
        }
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo img {
            width: 200px; /* Ajusta el tamaño del logo */
            height: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        table th, table td {
            padding: 10px;
            border: 1px solid #444;
            text-align: left;
        }

        table th {
            background-color: #00ff88;
            color: #1e1e2f;
        }

        table tr:nth-child(even) {
            background-color: #3a3a5a;
        }

        table tr:hover {
            background-color: #4a4a6a;
        }

        /* Animaciones */
        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .logo img {
            animation: rotate 5s linear infinite; /* Rotación continua */
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .menu a:hover {
            animation: bounce 0.1s ease-in-out; /* Efecto de rebote */
        }
        
        .content-list .item-container {
            display: flex;
            align-items: center;
            padding: 5px 0;
        }
        
        .content-list .canal-logo {
            width: 30px;
            height: 30px;
            object-fit: contain;
            margin-right: 10px;
            border-radius: 4px;
        }
        
        .content-list .item-nombre {
            flex: 1;
        }
        
        .info-reproduccion {
            margin-top: 15px;
            padding: 10px;
            background-color: #3a3a5a;
            border-radius: 8px;
            border-left: 4px solid #00ff88;
        }
        
        .info-reproduccion h3 {
            color: #00ff88;
            margin-top: 0;
        }
        
        .info-logo {
            max-width: 100px;
            max-height: 100px;
            display: block;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        
        .stream-url {
            display: block;
            font-family: monospace;
            background-color: #2a2a40;
            padding: 5px;
            border-radius: 4px;
            margin-top: 5px;
            word-break: break-all;
            font-size: 12px;
        }
        
        /* Sección de información de cuenta */
        .account-info {
            background-color: #3a3a5a;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #00ff88;
        }
        
        .account-info h2 {
            color: #00ff88;
            margin-top: 0;
            font-size: 18px;
        }
        
        .account-info p {
            margin: 5px 0;
        }
        
        .account-info .label {
            font-weight: bold;
            color: #00ff88;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo -->
        <div class="logo">
            <img src="https://i.postimg.cc/CxGSRwFQ/Python-free-icons-designed-by-Freepik.jpg" alt="Logo IPTV" width="200">
        </div>

        <!-- Leyenda en movimiento -->
        <div class="leyenda-movimiento">
            <marquee behavior="scroll" direction="left">
                @Techno2026 TOOLS IPTV <a href="https://whatsapp.com/channel/0029Vat0QigLikgCC1xikp1a" target="_blank">https://whatsapp.com/channel/0029Vat0QigLikgCC1xikp1a</a>
            </marquee>
        </div>

        <!-- Menú interactivo -->
        <div class="menu">
            <ul>
                <li><a href="#" onclick="mostrarCategorias(contenido, 'todos')">🏠 Inicio</a></li>
                <li><a href="#" onclick="mostrarCategorias(contenido, 'canales')" id="menuCanales" class="disabled">📺 Canales</a></li>
                <li><a href="#" onclick="mostrarCategorias(contenido, 'peliculas')" id="menuPeliculas" class="disabled">🎬 Películas</a></li>
                <li><a href="#" onclick="mostrarCategorias(contenido, 'series')" id="menuSeries" class="disabled">📚 Series</a></li>
            </ul>
        </div>

        <h1>REPRODUCTOR IPTV</h1>

        <!-- Formulario para verificar servidor -->
        <form id="iptvForm">
            <div class="info">
                <label>📡 Ingresar URL del servidor IPTV:</label>
                <input type="text" id="url" placeholder="http://example.com/get.php?username=USER&password=PASS&type=m3u_plus" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                <button type="submit" class="button">🔍 Verificar Servidor</button>
            </div>
        </form>

        <!-- Cargando -->
        <div id="loading" class="hidden">Cargando...</div>

        <!-- Resultados -->
        <div id="result"></div>
        
        <!-- Información de la cuenta -->
        <div id="accountInfo" class="account-info hidden">
            <h2>Información de la Cuenta</h2>
            <div id="accountDetails"></div>
        </div>
        
        <!-- Formulario para cargar lista M3U -->
        <div class="info">
            <label>📋 Pegar URL de Lista M3U:</label>
            <input type="text" id="m3uUrl" placeholder="http://example.com/get.php?username=USER&password=PASS&type=m3u_plus" style="width: 100%; padding: 8px; margin-bottom: 10px;">
            <button class="button" onclick="cargarLista()">📥 Cargar Lista</button>
        </div>

        <!-- Estado de la lista -->
        <div id="status" class="status"></div>

        <!-- Reproductor de video -->
        <div class="player" id="player">
            <label>🎥 Reproducir:</label>
            <video id="videoPlayer" controls>
                <source src="" type="video/mp4">
                Tu navegador no soporta la reproducción de video.
            </video>
            <button class="pip-button" id="pipButton" onclick="togglePictureInPicture()">🖼️ Activar PiP</button>
            <div id="infoReproduccion" class="info-reproduccion"></div>
        </div>

        <!-- Lista de contenido -->
        <div class="content-list">
            <h2>📋 Contenido</h2>
            <div id="categorias"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Variables globales
        let contenido = [];
        let currentServer = '';
        let currentUsername = '';
        let currentPassword = '';
        let prot = '';
        let host = '';
        let port = '';

        // Función para cargar lista M3U
        async function cargarLista() {
            const m3uUrl = document.getElementById('m3uUrl').value;
            if (!m3uUrl) {
                alert('Por favor, ingresa una URL válida.');
                return;
            }

            const statusDiv = document.getElementById('status');
            statusDiv.innerText = 'Cargando lista...';
            statusDiv.className = 'status';

            try {
                const response = await fetch(m3uUrl);
                const data = await response.text();
                const lineas = data.split('\n');

                contenido = [];
                let infoActual = {};

                for (let i = 0; i < lineas.length; i++) {
                    const linea = lineas[i].trim();
                    if (linea.startsWith('#EXTINF:')) {
                        const nombre = linea.split(',')[1];
                        const grupo = linea.match(/group-title="([^"]+)"/) ? linea.match(/group-title="([^"]+)"/)[1] : 'Otros';
                        let tipo = 'canal';
                        
                        // Extraer icono (logo) si existe
                        const icono = linea.match(/tvg-logo="([^"]+)"/) ? linea.match(/tvg-logo="([^"]+)"/)[1] : '';
                        
                        // Intentar determinar el tipo de contenido
                        if (grupo.toLowerCase().includes('película') || grupo.toLowerCase().includes('movie') || grupo.toLowerCase().includes('vod')) {
                            tipo = 'pelicula';
                        } else if (grupo.toLowerCase().includes('serie')) {
                            tipo = 'serie';
                        }
                        
                        // Extraer descripción si existe
                        const descripcion = linea.match(/tvg-description="([^"]+)"/) ? linea.match(/tvg-description="([^"]+)"/)[1] : '';
                        
                        infoActual = { 
                            nombre, 
                            url: lineas[i + 1].trim(), 
                            grupo,
                            tipo,
                            descripcion,
                            icono
                        };
                        contenido.push(infoActual);
                    }
                }

                // Habilitar botones del menú
                document.getElementById('menuCanales').classList.remove('disabled');
                document.getElementById('menuPeliculas').classList.remove('disabled');
                document.getElementById('menuSeries').classList.remove('disabled');
                
                mostrarCategorias(contenido, 'todos');
                statusDiv.innerText = '✅ Lista cargada correctamente.';
                statusDiv.className = 'status activa';
            } catch (error) {
                console.error('Error al cargar la lista:', error);
                statusDiv.innerText = '❌ Error al cargar la lista.';
                statusDiv.className = 'status inactiva';
            }
        }
        
        // Función para mostrar categorías
        function mostrarCategorias(contenido, tipo = 'todos') {
            const categoriasDiv = document.getElementById('categorias');
            categoriasDiv.innerHTML = '';
            
            // Limpiar reproductor actual
            document.getElementById('player').style.display = 'none';
            document.getElementById('videoPlayer').src = '';
            document.getElementById('infoReproduccion').innerHTML = '';
            
            if (!contenido || contenido.length === 0) {
                categoriasDiv.innerHTML = '<div class="status inactiva">No hay contenido disponible. Por favor, cargue una lista M3U o verifique un servidor.</div>';
                return;
            }

            const categorias = {};
            
            // Filtrar según el tipo seleccionado
            let contenidoFiltrado = contenido;
            if (tipo === 'canales') {
                contenidoFiltrado = contenido.filter(item => item.tipo === 'canal' || item.grupo.toLowerCase().includes('canal') || (!item.grupo.toLowerCase().includes('película') && !item.grupo.toLowerCase().includes('serie')));
            } else if (tipo === 'peliculas') {
                contenidoFiltrado = contenido.filter(item => item.tipo === 'pelicula' || item.grupo.toLowerCase().includes('película') || item.grupo.toLowerCase().includes('movie'));
            } else if (tipo === 'series') {
                contenidoFiltrado = contenido.filter(item => item.tipo === 'serie' || item.grupo.toLowerCase().includes('serie'));
            }

            contenidoFiltrado.forEach(item => {
                if (!categorias[item.grupo]) {
                    categorias[item.grupo] = [];
                }
                categorias[item.grupo].push(item);
            });
            
            if (Object.keys(categorias).length === 0) {
                categoriasDiv.innerHTML = `<div class="status inactiva">No se encontró contenido de tipo: ${tipo}</div>`;
                return;
            }

            for (const categoria in categorias) {
                const categoriaDiv = document.createElement('div');
                categoriaDiv.className = 'category';
                categoriaDiv.innerText = `🐍 ${categoria} (${categorias[categoria].length})`;
                categoriaDiv.addEventListener('click', () => mostrarSubcategorias(categoria, categorias[categoria]));
                categoriasDiv.appendChild(categoriaDiv);
            }
        }

        // Función para mostrar subcategorías
        function mostrarSubcategorias(categoria, items) {
            const categoriasDiv = document.getElementById('categorias');
            categoriasDiv.innerHTML = '';

            // Determinar qué tipo de contenido estamos mostrando para volver a la categoría correcta
            let tipoActual = 'todos';
            if (categoria.toLowerCase().includes('canal')) {
                tipoActual = 'canales';
            } else if (categoria.toLowerCase().includes('película') || categoria.toLowerCase().includes('movie')) {
                tipoActual = 'peliculas';
            } else if (categoria.toLowerCase().includes('serie')) {
                tipoActual = 'series';
            }

            const backButton = document.createElement('div');
            backButton.className = 'category';
            backButton.innerText = '← Volver';
            backButton.addEventListener('click', () => mostrarCategorias(contenido, tipoActual));
            categoriasDiv.appendChild(backButton);

            const subcategoriaDiv = document.createElement('div');
            subcategoriaDiv.className = 'subcategory';
            subcategoriaDiv.innerText = `📂 ${categoria} (${items.length})`;
            categoriasDiv.appendChild(subcategoriaDiv);

            // Ordenar elementos alfabéticamente
            items.sort((a, b) => a.nombre.localeCompare(b.nombre));

            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'content-list';
                
                // Ícono según tipo de contenido
                let icono = '📺';
                if (item.tipo === 'pelicula' || categoria.toLowerCase().includes('película') || categoria.toLowerCase().includes('movie')) {
                    icono = '🎬';
                } else if (item.tipo === 'serie' || categoria.toLowerCase().includes('serie')) {
                    icono = '📚';
                }
                
                // Crear un contenedor para el ítem con logo e información
                const itemContainer = document.createElement('div');
                itemContainer.className = 'item-container';
                
                // Agregar el logo si existe
                if (item.icono && typeof item.icono === 'string' && (item.icono.startsWith('http://') || item.icono.startsWith('https://'))) {
                    const logoImg = document.createElement('img');
                    logoImg.src = item.icono;
                    logoImg.alt = 'Logo';
                    logoImg.className = 'canal-logo';
                    logoImg.onerror = function() {
                        this.style.display = 'none'; // Ocultar la imagen si hay error al cargarla
                        this.parentNode.prepend(document.createTextNode(icono + ' ')); // Añadir el emoji como reemplazo
                    };
                    itemContainer.appendChild(logoImg);
                } else {
                    // Si no hay logo, usar el emoji
                    itemContainer.appendChild(document.createTextNode(icono + ' '));
                }
                
                // Agregar el nombre del canal/película/serie
                const nombreSpan = document.createElement('span');
                nombreSpan.innerText = item.nombre;
                nombreSpan.className = 'item-nombre';
                itemContainer.appendChild(nombreSpan);
                
                itemDiv.appendChild(itemContainer);
                itemDiv.addEventListener('click', () => reproducirContenido(item.url, item));
                categoriasDiv.appendChild(itemDiv);
            });
        }
        
        // Función para reproducir contenido
        function reproducirContenido(url, item) {
            const playerDiv = document.getElementById('player');
            const videoPlayer = document.getElementById('videoPlayer');
            const infoDiv = document.getElementById('infoReproduccion');

            playerDiv.style.display = 'block';
            
            // Si estamos en una verificación de servidor y la URL es relativa, construirla correctamente
            if (currentServer && !url.startsWith('http')) {
                // Para canales
                if (item.tipo === 'canal') {
                    url = `${prot}://${host}:${port}/live/${currentUsername}/${currentPassword}/${item.stream_id}.m3u8`;
                } 
                // Para películas
                else if (item.tipo === 'pelicula') {
                    const extension = item.extension || 'mp4';
                    url = `${prot}://${host}:${port}/movie/${currentUsername}/${currentPassword}/${item.stream_id}.${extension}`;
                } 
                // Para series
                else if (item.tipo === 'serie') {
                    url = `${prot}://${host}:${port}/series/${currentUsername}/${currentPassword}/${item.stream_id}.mp4`;
                }
            }
            
            // Determinar el tipo de stream y establecer el formato correcto
            let tipoVideo = 'video/mp4';
            
            // Limpiamos cualquier reproductor HLS anterior
            if (window.hls) {
                window.hls.destroy();
            }
            
            if (url.endsWith('.m3u8')) {
                tipoVideo = 'application/vnd.apple.mpegurl';
                
                // Para m3u8 usar Hls.js si está disponible
                if (Hls && Hls.isSupported()) {
                    window.hls = new Hls();
                    window.hls.loadSource(url);
                    window.hls.attachMedia(videoPlayer);
                    window.hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        videoPlayer.play();
                    });
                } 
                // Navegadores con soporte nativo (Safari)
                else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoPlayer.src = url;
                    videoPlayer.addEventListener('loadedmetadata', function() {
                        videoPlayer.play();
                    });
                } else {
                    // Fallback para navegadores que no soportan HLS
                    console.error('Tu navegador no soporta HLS');
                    infoDiv.innerHTML = '<div class="status inactiva">Tu navegador no soporta la reproducción de este formato.</div>';
                    return;
                }
            } else if (url.endsWith('.ts')) {
                tipoVideo = 'video/mp2t';
                videoPlayer.src = url;
                videoPlayer.load();
                videoPlayer.play();
            } else {
                // Formatos estándar como mp4
                videoPlayer.src = url;
                videoPlayer.load();
                videoPlayer.play();
            }
            
            // Mostrar información del contenido reproduciéndose
            let logoHtml = '';
            if (item.icono && typeof item.icono === 'string' && (item.icono.startsWith('http://') || item.icono.startsWith('https://'))) {
                logoHtml = `<img src="${item.icono}" alt="Logo" class="info-logo">`;
            }
            
            infoDiv.innerHTML = `
                <div class="info-reproduccion">
                    ${logoHtml}
                    <h3>${item.nombre}</h3>
                    <p><strong>Categoría:</strong> ${item.grupo}</p>
                    ${item.descripcion ? `<p><strong>Descripción:</strong> ${item.descripcion}</p>` : ''}
                    <p><strong>Stream URL:</strong> <span class="stream-url">${url}</span></p>
                </div>
            `;
        }

        // Función para activar Picture in Picture
        async function togglePictureInPicture() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (document.pictureInPictureElement) {
                await document.exitPictureInPicture();
            } else {
                await videoPlayer.requestPictureInPicture();
            }
        }

        // Verificar si el navegador soporta PiP
        const pipButton = document.getElementById('pipButton');
        if ('pictureInPictureEnabled' in document) {
            pipButton.style.display = 'inline-block';
        } else {
            pipButton.style.display = 'none';
        }
        
        // Verificar la compatibilidad del navegador con HLS
        const hlsSupported = (function() {
            const video = document.createElement('video');
            return video.canPlayType('application/vnd.apple.mpegurl') || 
                   typeof Hls !== 'undefined' && Hls.isSupported();
        })();
        
        if (!hlsSupported) {
            console.warn('Tu navegador no soporta HLS. Algunas transmisiones podrían no funcionar correctamente.');
        }
        
        // Verificar servidor y obtener el ID de Telegram que se está usando
        document.getElementById('iptvForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            let url = document.getElementById('url').value;

            let panel;
            try {
                const urlObj = new URL(url);
                panel = urlObj.hostname;
                prot = urlObj.protocol.replace(':', '');
                host = urlObj.hostname;
                port = urlObj.port || '80';
            } catch (e) {
                alert('URL inválida. Por favor, ingrese una URL válida.');
                return;
            }

            const headerj = {
                'content-type': 'application/json; charset=UTF-8',
                'User-Agent': '(Mozilla/5.0 (Linux; Android 9; ANE-LX3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.91 Mobile Safari/537.36)',
                'Host': panel,
                'Connection': 'Keep-Alive',
                'Accept-Encoding': 'gzip'
            };

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('result').innerHTML = '';
            document.getElementById('accountInfo').classList.add('hidden');

            url = url.replace('get.php', 'player_api.php');

            try {
                const [
                    userInfoResponse,
                    categoriesLiveResponse,
                    channelsResponse,
                    categoriesVODResponse,
                    vodResponse,
                    categoriesSeriesResponse,
                    seriesResponse
                ] = await Promise.all([
                    axios.get(url, { headers: headerj }),
                    axios.get(`${url}&action=get_live_categories`, { headers: headerj }),
                    axios.get(`${url}&action=get_live_streams`, { headers: headerj }),
                    axios.get(`${url}&action=get_vod_categories`, { headers: headerj }),
                    axios.get(`${url}&action=get_vod_streams`, { headers: headerj }),
                    axios.get(`${url}&action=get_series_categories`, { headers: headerj }),
                    axios.get(`${url}&action=get_series`, { headers: headerj })
                ]);

                const data = userInfoResponse.data;
                if (data.user_info && data.server_info) {
                    const username = data.user_info.username;
                    const password = data.user_info.password;
                    const expira = new Date(data.user_info.exp_date * 1000).toLocaleDateString();
                    const server = `${data.server_info.url}:${data.server_info.port}`;
                    const activeCons = data.user_info.active_cons;
                    const maxCons = data.user_info.max_connections;
                    const timezone = data.server_info.timezone;
                    
                    // Guardar información para uso posterior
                    currentServer = server;
                    currentUsername = username;
                    currentPassword = password;

                    // Mostrar información detallada de la cuenta
                    document.getElementById('accountInfo').classList.remove('hidden');
                    document.getElementById('accountDetails').innerHTML = `
                        <p><span class="label">Estado:</span> Activo</p>
                        <p><span class="label">Servidor:</span> ${server}</p>
                        <p><span class="label">Usuario:</span> ${username}</p>
                        <p><span class="label">Contraseña:</span> ${password}</p>
                        <p><span class="label">Fecha de Expiración:</span> ${expira}</p>
                        <p><span class="label">Conexiones Activas:</span> ${activeCons} de ${maxCons}</p>
                        <p><span class="label">Zona Horaria:</span> ${timezone}</p>
                        <p><span class="label">URL M3U:</span> ${url.replace('player_api.php', 'get.php')}&type=m3u_plus</p>
                    `;

                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('result').innerHTML = `
                        <div class="total-group">📺 Canales en Vivo (Total: ${calculateTotalChannels(channelsResponse.data)})</div>
                        
                        <div class="total-group">🎬 Películas VOD (Total: ${calculateTotalChannels(vodResponse.data)})</div>
                        
                        <div class="total-group">📚 Series (Total: ${calculateTotalChannels(seriesResponse.data)})</div>
                    `;
                    
                    // Convertir los datos del API a formato compatible con el reproductor
                    contenido = [];
                    
                    // Agregar canales en vivo
                    channelsResponse.data.forEach(channel => {
                        const categoria = categoriesLiveResponse.data.find(cat => cat.category_id === channel.category_id)?.category_name || 'Canales';
                        contenido.push({
                            nombre: channel.name,
                            url: `${prot}://${host}:${port}/live/${username}/${password}/${channel.stream_id}.m3u8`,
                            grupo: categoria,
                            tipo: 'canal',
                            descripcion: channel.stream_display_name || '',
                            icono: channel.stream_icon || '',
                            stream_id: channel.stream_id
                        });
                    });
                    
                    // Agregar películas VOD
                    vodResponse.data.forEach(vod => {
                        const categoria = categoriesVODResponse.data.find(cat => cat.category_id === vod.category_id)?.category_name || 'Películas';
                        const extension = vod.container_extension || 'mp4';
                        contenido.push({
                            nombre: vod.name,
                            url: `${prot}://${host}:${port}/movie/${username}/${password}/${vod.stream_id}.${extension}`,
                            grupo: categoria,
                            tipo: 'pelicula',
                            descripcion: vod.stream_display_name || '',
                            icono: vod.stream_icon || '',
                            stream_id: vod.stream_id,
                            extension: extension
                        });
                    });
                    
                    // Agregar series
                    seriesResponse.data.forEach(serie => {
                        const categoria = categoriesSeriesResponse.data.find(cat => cat.category_id === serie.category_id)?.category_name || 'Series';
                        contenido.push({
                            nombre: serie.name,
                            url: `${prot}://${host}:${port}/series/${username}/${password}/${serie.series_id}.mp4`,
                            grupo: categoria,
                            tipo: 'serie',
                            descripcion: serie.plot || '',
                            icono: serie.cover || '',
                            stream_id: serie.series_id
                        });
                    });
                    
                    // Habilitar botones del menú
                    document.getElementById('menuCanales').classList.remove('disabled');
                    document.getElementById('menuPeliculas').classList.remove('disabled');
                    document.getElementById('menuSeries').classList.remove('disabled');
                } else {
                    document.getElementById('result').innerHTML = `
                        <p style="color: red; font-weight: bold;">Lista no funcional</p>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = `
                    <p style="color: red; font-weight: bold;">Error al verificar la lista</p>
                `;
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        });

        function calculateTotalChannels(data) {
            return data.length;
        }

        function generateCategoryTable(categories, channels) {
            let html = '<table>';
            categories.forEach(category => {
                html += `<tr><th colspan="2">${category.category_name}</th></tr>`;
                channels.filter(channel => channel.category_id === category.category_id).forEach(channel => {
                    html += `<tr><td>${channel.name}</td><td>${channel.stream_icon ? `<img src="${channel.stream_icon}" width="50">` : ''}</td></tr>`;
                });
            });
            html += '</table>';
            return html;
        }
    </script>
</body>
</html>
